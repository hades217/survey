# Profile Detailsæ˜¾ç¤ºé—®é¢˜ä¿®å¤

## é—®é¢˜æè¿°

ç”¨æˆ·å®Œæˆæ³¨å†Œåï¼Œåœ¨Profile Settingsé‡Œçš„Profile Detailsä¸­çš„nameå’Œemailæ²¡æœ‰æŒ‰ç…§æ³¨å†Œæ—¶çš„ä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥ã€‚

## æ ¹æœ¬åŸå› åˆ†æ

**é—®é¢˜å‡ºç°åœ¨åç«¯ `routes/admin.js` çš„ `/admin/profile` æ¥å£ï¼š**

### åŸå§‹é—®é¢˜ä»£ç  (ç¬¬1534è¡Œ)

```javascript
// é”™è¯¯ï¼šæŸ¥æ‰¾ä»»æ„ä¸€ä¸ªadminç”¨æˆ·ï¼Œè€Œä¸æ˜¯å½“å‰ç™»å½•ç”¨æˆ·
let adminUser = await User.findOne({ role: 'admin' }).populate('companyId');
```

**é—®é¢˜åˆ†æï¼š**

1. `User.findOne({ role: 'admin' })` ä¼šè¿”å›æ•°æ®åº“ä¸­**ç¬¬ä¸€ä¸ª**adminç”¨æˆ·
2. ä¸ç®¡å½“å‰ç™»å½•çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œéƒ½ä¼šè¿”å›åŒä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯
3. å¦‚æœæœ‰å¤šä¸ªæ³¨å†Œç”¨æˆ·ï¼Œåæ³¨å†Œçš„ç”¨æˆ·çœ‹åˆ°çš„ä¼šæ˜¯ç¬¬ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯

### ä¿®å¤åçš„ä»£ç 

```javascript
// ä¿®å¤ï¼šæ ¹æ®JWT tokenä¸­çš„ç”¨æˆ·IDæŸ¥æ‰¾æ­£ç¡®çš„ç”¨æˆ·
let adminUser = null;

if (req.user.id && req.user.id !== 'admin') {
	// å¯¹äºæ³¨å†Œç”¨æˆ·ï¼šä½¿ç”¨JWT tokenä¸­çš„ç”¨æˆ·IDæŸ¥æ‰¾
	adminUser = await User.findById(req.user.id).populate('companyId');
} else {
	// å¯¹äºæ—§ç‰ˆadminï¼šä¿æŒåŸæœ‰é€»è¾‘ä½œä¸ºåå¤‡
	adminUser = await User.findOne({ role: 'admin' }).populate('companyId');
}
```

## ä¿®å¤é€»è¾‘

### 1. JWT TokenéªŒè¯

- æ£€æŸ¥ `req.user.id`ï¼ˆæ¥è‡ªJWT middleware `jwtAuth`ï¼‰
- å¦‚æœæ˜¯æœ‰æ•ˆçš„ç”¨æˆ·IDä¸”ä¸æ˜¯æ—§ç‰ˆ'admin'ï¼Œä½¿ç”¨è¯¥IDæŸ¥æ‰¾ç”¨æˆ·

### 2. ç”¨æˆ·æŸ¥æ‰¾ä¼˜å…ˆçº§

1. **æ³¨å†Œç”¨æˆ·**ï¼šä½¿ç”¨ `User.findById(req.user.id)` æŸ¥æ‰¾å…·ä½“ç”¨æˆ·
2. **æ—§ç‰ˆadmin**ï¼šä½¿ç”¨ `User.findOne({ role: 'admin' })` ä½œä¸ºåå¤‡

### 3. å‘åå…¼å®¹

- ä¿æŒå¯¹æ—§ç‰ˆç¯å¢ƒå˜é‡adminè´¦æˆ·çš„æ”¯æŒ
- ä¸ç ´åç°æœ‰çš„adminåŠŸèƒ½

## ä¿®å¤éªŒè¯

### è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆå®¹å™¨å¯åŠ¨ä¸­ï¼‰

```bash
node test_profile_display.js
```

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

#### æ­¥éª¤1ï¼šæ³¨å†Œæ–°ç”¨æˆ·

1. è®¿é—®ï¼šhttp://localhost:8080/admin/register
2. å¡«å†™ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š
    - Name: `å¼ ä¸‰`
    - Email: `zhangsan@example.com`
    - Password: `password123`
    - Company: `æµ‹è¯•å…¬å¸`
3. ç‚¹å‡»"Create Account"

#### æ­¥éª¤2ï¼šæ£€æŸ¥Profileæ˜¾ç¤º

1. æ³¨å†ŒæˆåŠŸåï¼Œå¯èƒ½è·³è½¬åˆ°onboardingé¡µé¢ï¼Œå®Œæˆæˆ–è·³è¿‡
2. è¿›å…¥admin dashboardåï¼Œç‚¹å‡»å³ä¸Šè§’çš„profileå›¾æ ‡
3. æˆ–ç›´æ¥è®¿é—®ï¼šhttp://localhost:8080/admin/profile
4. åœ¨"Profile Details"éƒ¨åˆ†æ£€æŸ¥ï¼š

**ä¿®å¤å‰çš„é”™è¯¯ç°è±¡ï¼š**

- âŒ Nameæ˜¾ç¤ºä¸ºï¼š"Administrator" æˆ–å…¶ä»–ç”¨æˆ·çš„åå­—
- âŒ Emailæ˜¾ç¤ºä¸ºï¼š"admin@example.com" æˆ–å…¶ä»–ç”¨æˆ·çš„é‚®ç®±

**ä¿®å¤åçš„æ­£ç¡®ç°è±¡ï¼š**

- âœ… Nameæ˜¾ç¤ºä¸ºï¼š"å¼ ä¸‰" (ä½ æ³¨å†Œæ—¶å¡«å†™çš„åå­—)
- âœ… Emailæ˜¾ç¤ºä¸ºï¼š"zhangsan@example.com" (ä½ æ³¨å†Œæ—¶å¡«å†™çš„é‚®ç®±)

#### æ­¥éª¤3ï¼šéªŒè¯ç”¨æˆ·éš”ç¦»

1. æ‰“å¼€æ–°çš„éšç§æµè§ˆå™¨çª—å£
2. æ³¨å†Œå¦ä¸€ä¸ªç”¨æˆ·ï¼Œä¾‹å¦‚ï¼š
    - Name: `æå››`
    - Email: `lisi@example.com`
3. æ£€æŸ¥æ–°ç”¨æˆ·çš„Profile Detailsåº”è¯¥æ˜¾ç¤º"æå››"å’Œ"lisi@example.com"
4. åŸçª—å£åˆ·æ–°profileé¡µé¢ï¼Œåº”è¯¥ä»ç„¶æ˜¾ç¤º"å¼ ä¸‰"çš„ä¿¡æ¯

## æŠ€æœ¯ç»†èŠ‚

### ç›¸å…³æ–‡ä»¶

- **ä¸»è¦ä¿®å¤**ï¼š`routes/admin.js` - `/admin/profile` æ¥å£
- **ç›¸å…³ç»„ä»¶**ï¼š
    - `client/src/contexts/AdminContext.tsx` - `loadProfile()` å‡½æ•°
    - `client/src/components/AdminDashboard.tsx` - Profileé¡µé¢æ˜¾ç¤º
    - `middlewares/jwtAuth.js` - JWTè®¤è¯ä¸­é—´ä»¶

### JWT Tokenç»“æ„

æ³¨å†Œ/ç™»å½•æˆåŠŸåï¼ŒJWT tokenåŒ…å«ï¼š

```javascript
{
  id: "ç”¨æˆ·çš„MongoDB ObjectId",
  email: "ç”¨æˆ·é‚®ç®±",
  role: "admin",
  iat: "ç­¾å‘æ—¶é—´",
  exp: "è¿‡æœŸæ—¶é—´"
}
```

### ä¿®å¤æµç¨‹

1. ç”¨æˆ·æ³¨å†Œ â†’ JWT tokenåŒ…å«ç”¨æˆ·ID
2. å‰ç«¯è°ƒç”¨ `/admin/profile` â†’ æºå¸¦JWT token
3. åç«¯è§£ætoken â†’ è·å–ç”¨æˆ·ID
4. æ•°æ®åº“æŸ¥è¯¢ â†’ `User.findById(ç”¨æˆ·ID)`
5. è¿”å›æ­£ç¡®ç”¨æˆ·ä¿¡æ¯ â†’ å‰ç«¯æ˜¾ç¤º

## éƒ¨ç½²çŠ¶æ€

- âœ… ä»£ç ä¿®å¤å·²å®Œæˆ
- âœ… Backendå®¹å™¨å·²é‡å»º
- ğŸ”„ ç­‰å¾…å®¹å™¨å®Œå…¨å¯åŠ¨
- ğŸ“‹ æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤å·²æä¾›

## é¢„æœŸç»“æœ

ä¿®å¤åï¼Œæ¯ä¸ªç”¨æˆ·ç™»å½•ååœ¨Profile Settingsä¸­çœ‹åˆ°çš„å°†æ˜¯è‡ªå·±æ³¨å†Œæ—¶å¡«å†™çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å…¶ä»–ç”¨æˆ·æˆ–é»˜è®¤adminçš„ä¿¡æ¯ï¼Œå®ç°äº†æ­£ç¡®çš„ç”¨æˆ·éš”ç¦»å’Œæ•°æ®æ˜¾ç¤ºã€‚
